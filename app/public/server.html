<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Survey Questions</title>

	<!-- Latest compiled and minified CSS & JS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

	<!-- Font Awesome Glyphicons -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

	<!-- Chosen -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>

</head>
<body>

	<div class="container">

		<h2>Survey Questions</h2>
		<hr>

		<h3><strong>About You</strong></h3>
		<h4>Name (Required)</h4>
		<input type="text" name="" id="name" class="form-control" required >

		<h4>Link to Photo Image (Required)</h4>
		<input type="text" name="" id="photo" class="form-control" required >

		<hr>

		<h3 id = "questionNum1" ></h3>
		<h4 id = "questionOne" ></h4>
	 	<select data-placeholder = "" class = "chosen-select" id = "q1">
	 		<option value = ""></option>
            <option value = "1">1 (Strongly Disagree)</option>
            <option value = "2">2</option>
            <option value = "3">3</option>
            <option value = "4">4</option>
            <option value = "5">5 (Strongly Agree)</option>
      	</select>

		<h3 id = "questionNum2" ></h3>
		<h4 id = "questionTwo" ></h4>
	 	<select data-placeholder = "" class = "chosen-select" id = "q2">
	 		<option value = ""></option>
            <option value = "1">1 (Strongly Disagree)</option>
            <option value = "2">2</option>
            <option value = "3">3</option>
            <option value = "4">4</option>
            <option value = "5">5 (Strongly Agree)</option>
      	</select>


		<h3 id = "questionNum3" ></h3>
		<h4 id = "questionThree" ></h4>
	 	<select data-placeholder = "" class = "chosen-select" id = "q3">
	 		<option value = ""></option>
            <option value = "1">1 (Strongly Disagree)</option>
            <option value = "2">2</option>
            <option value = "3">3</option>
            <option value = "4">4</option>
            <option value = "5">5 (Strongly Agree)</option>
      	</select>


		<h3 id = "questionNum4" ></h3>
		<h4 id = "questionFour" ></h4>
	 	<select data-placeholder = "" class = "chosen-select" id = "q4">
	 		<option value = ""></option>
            <option value = "1">1 (Strongly Disagree)</option>
            <option value = "2">2</option>
            <option value = "3">3</option>
            <option value = "4">4</option>
            <option value = "5">5 (Strongly Agree)</option>
      	</select>


		<h3 id = "questionNum5" ></h3>
		<h4 id = "questionFive" ></h4>
	 	<select data-placeholder = "" class = "chosen-select" id = "q5">
	 		<option value = ""></option>
            <option value = "1">1 (Strongly Disagree)</option>
            <option value = "2">2</option>
            <option value = "3">3</option>
            <option value = "4">4</option>
            <option value = "5">5 (Strongly Agree)</option>
      	</select>


		<h3 id = "questionNum6" ></h3>
		<h4 id = "questionSix" ></h4>
	 	<select data-placeholder = "" class = "chosen-select" id = "q6">
	 		<option value = ""></option>
            <option value = "1">1 (Strongly Disagree)</option>
            <option value = "2">2</option>
            <option value = "3">3</option>
            <option value = "4">4</option>
            <option value = "5">5 (Strongly Agree)</option>
      	</select>


		<h3 id = "questionNum7" ></h3>
		<h4 id = "questionSeven" ></h4>
	 	<select data-placeholder = "" class = "chosen-select" id = "q7">
	 		<option value = ""></option>
            <option value = "1">1 (Strongly Disagree)</option>
            <option value = "2">2</option>
            <option value = "3">3</option>
            <option value = "4">4</option>
            <option value = "5">5 (Strongly Agree)</option>
      	</select>

		<h3 id = "questionNum8" ></h3>
		<h4 id = "questionEight" ></h4>
	 	<select data-placeholder = "" class = "chosen-select" id = "q8">
	 		<option value = ""></option>
            <option value = "1">1 (Strongly Disagree)</option>
            <option value = "2">2</option>
            <option value = "3">3</option>
            <option value = "4">4</option>
            <option value = "5">5 (Strongly Agree)</option>
      	</select>

		<h3 id = "questionNum9" ></h3>
		<h4 id = "questionNine" ></h4>
	 	<select data-placeholder = "" class = "chosen-select" id = "q9">
	 		<option value = ""></option>
            <option value = "1">1 (Strongly Disagree)</option>
            <option value = "2">2</option>
            <option value = "3">3</option>
            <option value = "4">4</option>
            <option value = "5">5 (Strongly Agree)</option>
      	</select>

		<h3 id = "questionNum10" ></h3>
		<h4 id = "questionTen" ></h4>
	 	<select data-placeholder = "" class = "chosen-select" id = "q10">
	 		<option value = ""></option>
            <option value = "1">1 (Strongly Disagree)</option>
            <option value = "2">2</option>
            <option value = "3">3</option>
            <option value = "4">4</option>
            <option value = "5">5 (Strongly Agree)</option>
      	</select>

		<br>
		<br>

		<!-- Submit Button -->
		<button type="submit" class="btn btn-primary btn-lg btn-block" id="submit">
			<i class="fa fa-check-circle" aria-hidden="true"></i>
 		Submit</button>

		<hr>
	    <footer class="footer">
	      <div class="container">
		        <p><a href="/api/friendDataSet">API Friends List</a></p>
	      </div>
	    </footer>

	</div>

	<!-- Modal -->
	<div id="resultsModal" class="modal fade" role="dialog">
	  <div class="modal-dialog">

	    <!-- Modal content-->
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal">&times;</button>
	        <h2 class="modal-title"><strong>Best Match</strong></h2>
	      </div>
	      <div class="modal-body" id = "imgTest">
					<h2 id="matchName"></h2>
	        <img id="matchImg" style="width: 500px;" src="https://vignette4.wikia.nocookie.net/youtubepoop/images/c/c0/Goofy_Yop.jpg/revision/latest/scale-to-width-down/266?cb=20130310121325" alt="">
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	      </div>
	    </div>

	  </div>
	</div>

  <!-- <script src = "server.js"></script> -->
	<script type="text/javascript">

		// Question numbers and questions/statements
		var questions = [
			"Question 1", "You think a career is important.",
			"Question 2", "You want to have kids.",
			"Question 3", "Smoking bothers you.",
			"Question 4", "Family is important to you.",
			"Question 5", "You're an animal lover.",
			"Question 6", "Your favorite food is italian.",
			"Question 7", "Sports are an important factor in your life.",
			"Question 8", "You are religious.",
			"Question 9", "Passion & intellect are attractive qualities.",
			"Question 10", "You prefer books over television."
		];

		function questionsAppend(){
			// Question headers appended to html
			$("#questionNum1").append("<h4><strong>" + questions[0] + "</strong></h4>");
			$("#questionNum2").append("<h4><strong>" + questions[2] + "</strong></h4>");
			$("#questionNum3").append("<h4><strong>" + questions[4] + "</strong></h4>");
			$("#questionNum4").append("<h4><strong>" + questions[6] + "</strong></h4>");
			$("#questionNum5").append("<h4><strong>" + questions[8] + "</strong></h4>");
			$("#questionNum6").append("<h4><strong>" + questions[10] + "</strong></h4>");
			$("#questionNum7").append("<h4><strong>" + questions[12] + "</strong></h4>");
			$("#questionNum8").append("<h4><strong>" + questions[14] + "</strong></h4>");
			$("#questionNum9").append("<h4><strong>" + questions[16] + "</strong></h4>");
			$("#questionNum10").append("<h4><strong>" + questions[18] + "</strong></h4>");

			// Questions/Statements appended to html
			$("#questionOne").append("<h4>" + questions[1] + "</h4>");			
			$("#questionTwo").append("<h4>" + questions[3] + "</h4>");			
			$("#questionThree").append("<h4>" + questions[5] + "</h4>");
			$("#questionFour").append("<h4>" + questions[7] + "</h4>");
			$("#questionFive").append("<h4>" + questions[9] + "</h4>");			
			$("#questionSix").append("<h4>" + questions[11] + "</h4>");
			$("#questionSeven").append("<h4>" + questions[13] + "</h4>");
			$("#questionEight").append("<h4>" + questions[15] + "</h4>");
			$("#questionNine").append("<h4>" + questions[17] + "</h4>");			
			$("#questionTen").append("<h4>" + questions[19] + "</h4>");
		}
		questionsAppend();

  	// Chosen CSS
    var config = {
      '.chosen-select'           : {},
      '.chosen-select-deselect'  : {allow_single_deselect:true},
      '.chosen-select-no-single' : {disable_search_threshold:10},
      '.chosen-select-no-results': {no_results_text:'Oops, nothing found!'},
      '.chosen-select-width'     : {width:"95%"}
    }
    for (var selector in config) {
      $(selector).chosen(config[selector]);
    }

    // Capture the form inputs 
    $("#submit").on("click", function(){

    	// Form validation
    	function validateForm() {
		  var isValid = true;
		  $('.form-control').each(function() {
		    if ( $(this).val() === '' )
		        isValid = false;
		  });

		  $('.chosen-select').each(function() {

		  	if( $(this).val() === "")
		  		isValid = false
		  })
		  return isValid;
		}

		// If all required fields are filled
		if (validateForm() == true)
		{
			// Create an object for the user's data
			var userData = {
				name: $("#name").val(),
				photo: $("#photo").val(),
				scores: [
					$("#q1").val(), $("#q2").val(), $("#q3").val(),
					$("#q4").val(), $("#q5").val(), $("#q6").val(),
					$("#q7").val(), $("#q8").val(), $("#q9").val(),
					$("#q10").val(), 
				]
			}
			var totalScore = parseInt(userData.scores[0]) + parseInt(userData.scores[1]) + 
												parseInt(userData.scores[2]) + parseInt(userData.scores[3]) + 
												parseInt(userData.scores[4]) + parseInt(userData.scores[5]) + 
												parseInt(userData.scores[6]) + parseInt(userData.scores[7]) + 
												parseInt(userData.scores[8]) + parseInt(userData.scores[9]);

			// Grab the URL of the website
			var currentURL = window.location.origin;
	
			// AJAX post the data to the friends API. 
			$.post(currentURL + "/api/friendDataSet", userData, function(data){
				// Grab the result from the AJAX post so that the best match's name and photo are displayed.
				$("#matchName").text(data.name);
				$('#matchImg').attr("src", data.photo);
				// Show the modal with the best match 
				$("#resultsModal").modal('toggle');
			});


			// https://uclax.bootcampcontent.com/UCLA-Coding-Boot-Camp/04-2017-Class-Repository/blob/master/13-Week/13.3/16-HotRestaurant/app/public/tables.html
			$.ajax({ url: currentURL + "/api/friendDataSet", method: "GET"})
			.done(function(friendData){
				var minDiff = Infinity;
				var friendIndex = null;
				// Loop through and display each of the friends
				// calculate differences between user and current friend. If differences lower than current lowest differences, then update closest friend
        for (var i = 0; i < 4; i++) {
					var friendScores = friendData[i].scores[0] + friendData[i].scores[1] + friendData[i].scores[2] + friendData[i].scores[3] + friendData[i].scores[4]
													+ friendData[i].scores[5] + friendData[i].scores[6] + friendData[i].scores[7] + friendData[i].scores[8] + friendData[i].scores[9];

					var totalDifference = Math.abs(friendScores - totalScore);
					var totalDiffPush = friendData[i].totalDiff;
					totalDiffPush.push(totalDifference);

					if (totalDifference < minDiff) {
						minDiff = totalDifference;
						friendIndex = i;
					}
				}

				// Appended to the modal
				$("#matchName").append(friendData[friendIndex].name);
				console.log("Photo: " + friendData[friendIndex].photo);
				// $("#imgTest").prepend($("<img>",{id: "matchImg", src: "'" + friendData[friendIndex].photo + "'/>"}));
				$("#matchImg").attr("src", friendData[friendIndex].photo);



				// $('#profile_image').attr("src", image);
	      // <div class="modal-body" id = "imgTest">
				// 	<h2 id="matchName"></h2>
	      //   <img id="matchImg" src="https://1325" alt="">
	      // </div>

			})
			var getter = $.get(currentURL + "/api/friendDataSet", userData, function(data){
				// Grab the result from the AJAX post so that the best match's name and photo are displayed.
				return userData;
			});
		}
		else
		{
			alert("Please fill out all fields before submitting!");
		}
    	return false;
    });
  </script>
</body>
</html>